generator client {
    provider = "prisma-client"
    output   = "./generated/"
}

datasource db {
    provider = "sqlite"
}

//////////////////////////////////////
// ENUMS
//////////////////////////////////////

enum VatRateType {
  STANDARD
  REDUCED
  ZERO
}

enum EstimateStatus {
  Template
  Draft
  Sent
  Accepted
  Refused
}

enum InvoiceStatus {
  Draft
  Issued
  Paid
  Overdue
  Cancelled
}

//////////////////////////////////////
// USER & COMPANY
//////////////////////////////////////

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  password  String

  company   Company? @relation(fields: [companyId], references: [id])
  companyId String?
}

model Company {
  id      String @id @default(uuid())
  name    String
  email   String
  adress  String
  SIRET   String
  phone   String

  users   User[]
}

//////////////////////////////////////
// STOCK ARTICLE
//////////////////////////////////////

model StockArticle {
  id          String   @id @default(uuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  name        String
  sku         String   @unique
  description String?
  unitPrice   Float
  vatRateType VatRateType

  quantity    Int
}

//////////////////////////////////////
// SERVICE
//////////////////////////////////////

model Service {
  id            String   @id @default(uuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  name          String
  code          String   @unique
  description   String?
  unitPrice     Float
  vatRateType   VatRateType
  durationHours Float?
}

//////////////////////////////////////
// CLIENT
//////////////////////////////////////

model Client {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  firstName String
  lastName  String
  email     String
  company   String
  phone     String
  address   String

  estimates Estimate[]
  invoices  Invoice[]
}

model Invoice {
  id             String        @id @default(cuid())
  invoiceNumber  String
  dueDate        DateTime

  issuedAt       DateTime?
  paidAt         DateTime?
  paymentMethod  String?

  estimateId     String?
  estimate       Estimate?     @relation(fields: [estimateId], references: [id])

  clientId       String?
  client         Client?       @relation(fields: [clientId], references: [id])

  lines          BillableLine[]

  notes          String        @default("")

  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@index([clientId])
  @@index([invoiceNumber])
}

model Estimate {
  id           String        @id @default(cuid())
  reference    String

  generatedAt  DateTime?
  status       EstimateStatus @default(Draft)

  clientId     String?
  client       Client?       @relation(fields: [clientId], references: [id])

  lines        BillableLine[]

  notes        String        @default("")

  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  @@index([clientId])
  @@index([reference])
}

model BillableLine {
  id             String       @id @default(cuid())

  quantity       Int
  unitPrice      Decimal      @db.Decimal(10, 2)
  vatRate        Decimal      @db.Decimal(5, 4)

  itemId         String
  item           BillableItem @relation(fields: [itemId], references: [id])

  invoiceId      String?
  invoice        Invoice?     @relation(fields: [invoiceId], references: [id])

  estimateId     String?
  estimate       Estimate?    @relation(fields: [estimateId], references: [id])

  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  @@index([itemId])
  @@index([invoiceId])
  @@index([estimateId])
}